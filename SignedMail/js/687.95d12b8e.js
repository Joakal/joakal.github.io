"use strict";(self["webpackChunksignedmail"]=self["webpackChunksignedmail"]||[]).push([[687],{7687:(e,t,a)=>{a.r(t),a.d(t,{default:()=>j});var i=a(3673),l=a(2323);const n={key:0},o={key:1},s=(0,i.Uk)(" There are messages that are currently encrypted. "),r=(0,i.Uk)("Try decrypting again"),c={key:2,style:{width:"100%","max-width":"400px"}};function u(e,t,a,u,d,y){const v=(0,i.up)("q-btn"),p=(0,i.up)("q-banner"),g=(0,i.up)("q-icon"),m=(0,i.up)("q-tooltip"),h=(0,i.up)("q-chat-message"),f=(0,i.up)("q-input"),k=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"bg-primary text-white"},{default:(0,i.w5)((()=>{var t;return[(0,i.Wm)(v,{round:"",icon:"arrow_circle_left",onClick:e.goBack},null,8,["onClick"]),(0,i.Uk)(" "+(0,l.zw)(null===(t=e.publicKey)||void 0===t?void 0:t.userID),1)]})),_:1}),e.publicKey?e.hasEncryptedMessages?((0,i.wg)(),(0,i.iD)("span",o,[s,(0,i.Wm)(v,{color:"primary",onClick:e.retryDecryption},{default:(0,i.w5)((()=>[r])),_:1},8,["onClick"])])):((0,i.wg)(),(0,i.iD)("div",c,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.chats,((t,a)=>{var n;return(0,i.wg)(),(0,i.j4)(h,(0,i.dG)({key:a},t,{name:t.detail.chatUserID,text:[t.chat],stamp:null===(n=t.detail.createdDate)||void 0===n?void 0:n.toLocaleString(),sent:"self"===t.detail.verification,"text-color":"self"===t.detail.verification?"white":"black","bg-color":"self"===t.detail.verification?"primary":"grey-4",clickable:"",exact:""}),(0,i.Nv)({_:2},["self"!==t.detail.verification?{name:"stamp",fn:(0,i.w5)((()=>{var a;return[(0,i.Uk)((0,l.zw)(null===(a=t.detail.createdDate)||void 0===a?void 0:a.toLocaleString())+" ",1),"verified"===t.detail.verification?((0,i.wg)(),(0,i.j4)(g,{key:0,name:"check_circle_outline",color:"positive"})):((0,i.wg)(),(0,i.j4)(g,{key:1,name:"error_outline",color:"negative"},{default:(0,i.w5)((()=>["not_found"===t.detail.verification?((0,i.wg)(),(0,i.j4)(m,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)(" There was no matching public key found for "+(0,l.zw)(e.theirPublicKeyID),1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" The signature verification failed for "+(0,l.zw)(e.theirPublicKeyID),1)])),_:1})])),_:2},1024))]}))}:void 0]),1040,["name","text","stamp","sent","text-color","bg-color"])})),128)),(0,i.Wm)(f,{"bottom-slots":"",modelValue:e.text,"onUpdate:modelValue":t[1]||(t[1]=t=>e.text=t),type:"textarea"},{append:(0,i.w5)((()=>[""!==e.text?((0,i.wg)(),(0,i.j4)(g,{key:0,name:"close",onClick:t[0]||(t[0]=t=>e.text=""),class:"cursor-pointer"})):(0,i.kq)("",!0)])),after:(0,i.w5)((()=>[(0,i.Wm)(v,{round:"",dense:"",flat:"",icon:"send",onClick:e.submitMessage},null,8,["onClick"])])),_:1},8,["modelValue"])])):((0,i.wg)(),(0,i.iD)("span",n," No public key could be found. Have you added their public key? "))])),_:1})}var d=a(8430),y=a(1959),v=a(8825),p=a(9582),g=a(8599),m=a(912),h=a(27),f=a(6598),k=a(2079);const w=e=>(0,d.mG)(void 0,void 0,void 0,(function*(){try{return yield(0,g.Rk)({armoredMessage:e}),!0}catch(t){return!1}})),b=(0,i.aZ)({name:"Chats",setup(){const e=(0,v.Z)(),t=(0,p.tv)(),a=(0,p.yj)(),l=(0,y.iH)(""),n=(0,y.iH)(""),o=(0,y.iH)(""),s=(0,y.Fl)((()=>h.Vu.getChatsByPrivateKeyIDAndPublicKeyID(l.value,n.value))),r=(0,y.Fl)((()=>h.Vu.getMessagesByPrivateKeyID(l.value))),c=(0,y.Fl)((()=>k.gb.getPublicKeyByKeyID(n.value))),u=()=>(0,d.mG)(this,void 0,void 0,(function*(){if(r.value.length>s.value.length)try{yield(0,m.Z0)(l.value)}catch(t){const a=t;e.notify({type:"negative",message:`Could not convert messages into chats. Reason: ${a.message}`})}}));(0,i.bv)((()=>(0,d.mG)(this,void 0,void 0,(function*(){a.params.myPrivateKeyID&&(l.value=a.params.myPrivateKeyID,n.value=a.params.theirPublicKeyID,c.value&&(yield u()))}))));const g=()=>(0,d.mG)(this,void 0,void 0,(function*(){const t=yield w(o.value);try{if(t)yield(0,m.yv)(o.value);else{const{theirEncryptedMessage:e}=yield(0,m.Ji)(o.value,n.value,l.value);yield(0,f.H)({label:"Encrypted message copied to clipboard",value:e})}}catch(a){const t=a;e.notify({type:"negative",message:`Could not process message. Reason: ${t.message}`})}o.value=""}));return{hasEncryptedMessages:(0,y.Fl)((()=>h.Vu.hasEncryptedMessages(l.value))),text:o,chats:s,theirPublicKeyID:n,publicKey:c,rowClick:e=>t.push({name:"history",params:{id:e}}),clickMessage:()=>console.log("Message clicked!"),submitMessage:g,retryDecryption:()=>(0,d.mG)(this,void 0,void 0,(function*(){return yield u()})),goBack:()=>t.push({name:"chats",params:{myPrivateKeyID:l.value}})}}});var D=a(4260),K=a(4379),C=a(5607),I=a(8240),x=a(629),_=a(4554),P=a(8870),M=a(4842),Z=a(7518),q=a.n(Z);const U=(0,D.Z)(b,[["render",u]]),j=U;q()(b,"components",{QPage:K.Z,QBanner:C.Z,QBtn:I.Z,QChatMessage:x.Z,QIcon:_.Z,QTooltip:P.Z,QInput:M.Z})}}]);