"use strict";(self["webpackChunksignedmail"]=self["webpackChunksignedmail"]||[]).push([[64],{27:(e,t,i)=>{i.d(t,{DN:()=>o,Vu:()=>d});var r=i(8430),s=i(5718),a=i(556),n=i(1055);const o=()=>"undefined"!==window.localStorage.getItem(n.pf)?JSON.parse(window.localStorage.getItem(n.pf)||"[]"):[],y=e=>e.sort(((e,t)=>e.detail.createdDate&&t.detail.createdDate?+e.detail.createdDate-+t.detail.createdDate:0));let l=class extends s.g4{constructor(){super(...arguments),this.chats=[],this.messages=[]}addChat(e){const{chat:t}=e;this.chats.push(t)}addMessage(e){const{message:t}=e;this.messages.push(t)}removeChat(e){const{chat:t}=e;this.chats=this.chats.filter((e=>e.chat!==t.chat))}removeMessage(e){const{message:t}=e;this.messages=this.messages.filter((e=>e.message!==t.message))}initialiseMessages(e){this.messages=e}initialiseChats(e){this.chats=y(e)}get getChats(){return this.chats}get getChatsByPrivateKeyID(){return e=>this.chats.filter((t=>t.detail.myPrivateKeyID===e))}get getChatsByPrivateKeyIDAndPublicKeyID(){return(e,t)=>this.chats.filter((i=>i.detail.myPrivateKeyID===e&&i.detail.theirPublicKeyID===t))}get getUniqueChatsByPrivateKeyID(){return e=>{const t=this.getChatsByPrivateKeyID(e);return[...new Map(t.map((e=>[e.detail.theirPublicKeyID,e]))).values()]}}get getMessages(){return this.messages}get getMessagesByPrivateKeyID(){return e=>this.messages.filter((t=>t.detail.myPrivateKeyID===e))}get hasEncryptedMessages(){return e=>e?this.getMessagesByPrivateKeyID(e).length>0&&0===this.getChatsByPrivateKeyID(e).length:this.getMessages.length>0&&0===this.chats.length}};(0,r.gn)([s.mm],l.prototype,"addChat",null),(0,r.gn)([s.mm],l.prototype,"addMessage",null),(0,r.gn)([s.mm],l.prototype,"removeChat",null),(0,r.gn)([s.mm],l.prototype,"removeMessage",null),(0,r.gn)([s.mm],l.prototype,"initialiseMessages",null),(0,r.gn)([s.mm],l.prototype,"initialiseChats",null),l=(0,r.gn)([(0,s.Yl)({dynamic:!0,namespaced:!0,name:"chats",store:a["default"]})],l);a["default"].subscribe((({type:e},{chats:t})=>{"chats"===e.substring(0,5)&&"chats/initialiseMessages"!==e&&window.localStorage.setItem(n.pf,JSON.stringify(t.messages))}));const d=(0,s.rT)(l)},2079:(e,t,i)=>{i.d(t,{a7:()=>y,gb:()=>c});var r=i(8430),s=i(5718),a=i(556),n=i(745),o=i(1055);const y=()=>JSON.parse(window.localStorage.getItem(o.Uf)||"null"),l=(e,t)=>(0,r.mG)(void 0,void 0,void 0,(function*(){let i="";i="private"===e?yield(0,n.Z9)(t):yield(0,n.DI)(t);const r=yield(0,n.VH)(t),s=r.join(", ");return{key:t,userID:s,keyID:i}}));let d=class extends s.g4{constructor(){super(...arguments),this.publicKeys=[],this.privateKeys=[],this.defaults={chat:{privateKeyID:void 0},encrypt:{privateKeyID:void 0,publicKeyID:void 0},decrypt:{privateKeyID:void 0,publicKeyID:void 0},signingKeyID:void 0,verifyingKeyID:void 0,displayKeyID:void 0}}addPublicKey(e){this.publicKeys.push(e)}removePublicKey(e){this.publicKeys=this.publicKeys.filter((t=>t.keyID!==e))}addPrivateKey(e){this.privateKeys.push(e)}removePrivateKey(e){this.privateKeys=this.privateKeys.filter((t=>t.keyID!==e))}changeDefaultEncryptPrivateKey(e){this.defaults.encrypt.privateKeyID=e}changeDefaultEncryptPublicKey(e){this.defaults.encrypt.publicKeyID=e}changeDefaultDecryptPrivateKey(e){this.defaults.decrypt.privateKeyID=e}changeDefaultDecryptPublicKey(e){this.defaults.decrypt.publicKeyID=e}changeDefaultSigning(e){this.defaults.signingKeyID=e}changeDefaultVerifying(e){this.defaults.verifyingKeyID=e}changeDefaultDisplay(e){this.defaults.displayKeyID=e}changeDefaultChatPrivateKey(e){this.defaults.chat.privateKeyID=e}initialiseKeys(e){const{publicKeys:t,privateKeys:i,defaults:r}=e;this.publicKeys=t,this.privateKeys=i,this.defaults=r}addKeys(e){return(0,r.mG)(this,void 0,void 0,(function*(){const{keys:t}=e,i=yield l("public",t.publicKey.armor());if(this.addPublicKey(i),t.privateKey){const e=yield l("private",t.privateKey.armor());this.addPrivateKey(e)}}))}importPublicKey(e){return(0,r.mG)(this,void 0,void 0,(function*(){const{key:t}=e,i=yield l("public",t.armor());this.addPublicKey(i)}))}importPrivateKey(e){return(0,r.mG)(this,void 0,void 0,(function*(){const{key:t}=e,i=yield l("public",t.armor());this.addPrivateKey(i)}))}removeKeys(e){const{keys:t}=e;this.removePublicKey(t.publicKey.armor()),t.privateKey&&this.removePrivateKey(t.privateKey.armor())}get getPublicKeys(){return this.publicKeys}get getPublicKeysWithoutPrivateKey(){return e=>(0,r.mG)(this,void 0,void 0,(function*(){const t=this.getPrivateKeyByKeyID(e);if(!t)return[];const i=yield(0,n.DI)(t.key);return this.publicKeys.filter((e=>e.keyID!==i))}))}get getPublicKeyByKeyID(){return e=>this.publicKeys.find((t=>t.keyID===e))}get getPrivateKeys(){return this.privateKeys}get getPrivateKeyByKeyID(){return e=>this.privateKeys.find((t=>t.keyID===e))}get getDefaults(){return this.defaults}get getPrivateKeyByChatDefault(){return()=>{if(this.defaults.chat.privateKeyID)return this.getPrivateKeyByKeyID(this.defaults.chat.privateKeyID)}}};(0,r.gn)([s.mm],d.prototype,"addPublicKey",null),(0,r.gn)([s.mm],d.prototype,"removePublicKey",null),(0,r.gn)([s.mm],d.prototype,"addPrivateKey",null),(0,r.gn)([s.mm],d.prototype,"removePrivateKey",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultEncryptPrivateKey",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultEncryptPublicKey",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultDecryptPrivateKey",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultDecryptPublicKey",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultSigning",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultVerifying",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultDisplay",null),(0,r.gn)([s.mm],d.prototype,"changeDefaultChatPrivateKey",null),(0,r.gn)([s.mm],d.prototype,"initialiseKeys",null),(0,r.gn)([s.aU],d.prototype,"addKeys",null),(0,r.gn)([s.aU],d.prototype,"importPublicKey",null),(0,r.gn)([s.aU],d.prototype,"importPrivateKey",null),(0,r.gn)([s.aU],d.prototype,"removeKeys",null),d=(0,r.gn)([(0,s.Yl)({dynamic:!0,namespaced:!0,stateFactory:!0,name:"keys",store:a["default"]})],d);a["default"].subscribe((({type:e},{keys:t})=>{"keys"===e.substring(0,4)&&"keys/initialiseKeys"!==e&&window.localStorage.setItem(o.Uf,JSON.stringify(t))}));const c=(0,s.rT)(d)},912:(e,t,i)=>{i.d(t,{Ji:()=>y,yv:()=>l,Z0:()=>d});var r=i(8430),s=i(8599),a=i(745),n=i(2079),o=i(27);function y(e,t,i){return(0,r.mG)(this,void 0,void 0,(function*(){const r="",o={theirPublicKeyID:t,chat:e},y=JSON.stringify(o),l=yield(0,s.tn)({text:y}),d=yield(0,s.tn)({text:e}),c=n.gb.getPublicKeys.find((e=>e.keyID===t));if(!c)throw new Error(`Could not find the public key for ${t}`);const u=yield(0,a.yG)({armoredKey:c.key}),g=n.gb.getPrivateKeys.find((e=>e.keyID===i));if(!g)throw new Error(`Could not find the private key for ${i}`);const p=yield(0,a.CS)(g.key),m=p.toPublic(),h=yield(0,s.HI)({message:d,encryptionKeys:u,signingKeys:p}),v=yield(0,s.HI)({message:l,encryptionKeys:m,signingKeys:p}),f=yield(0,a.yr)({armoredMessage:v});if(!f)throw console.error("Could not read message",f),new Error("Could not read message");const K=yield(0,s.pe)({message:f,decryptionKeys:p}),D=yield K.signatures[0].signature,{created:I}=D.packets[0];return{theirEncryptedMessage:h,chat:{detail:{theirPublicKeyID:t,myPrivateKeyID:i,verification:"self",userID:u.getUserIDs().join(", "),chatUserID:p.getUserIDs().join(", "),createdDate:I},chat:e},message:{detail:{myPrivateKeyID:i},message:v},error:r}}))}function l(e){return(0,r.mG)(this,void 0,void 0,(function*(){let t;const i=yield(0,a.yr)({armoredMessage:e});if(!i)throw console.error("Not a valid pgp message",e),new Error("Not a valid pgp message");const r=i.getEncryptionKeyIDs().map((e=>e.toHex())),y=r[0],l=n.gb.getPrivateKeys.find((e=>e.keyID===y));if(!l)throw new Error(`Could not find the private key for ${r[0]}`);const d=yield(0,a.CS)(l.key),c=yield(0,s.pe)({message:i,decryptionKeys:d}),u=yield c.signatures[0].signature,{created:g}=u.packets[0],p=c.signatures[0].keyID.toHex(),m=n.gb.getPublicKeys.find((e=>e.keyID===p));if(m){const i=yield(0,a.yG)({armoredKey:m.key}),r=yield(0,a.yr)({armoredMessage:e});if(!r)throw console.error("Not a valid pgp message",e),new Error("Not a valid pgp message");const n=yield(0,s.pe)({message:r,decryptionKeys:d,verificationKeys:i}),o=yield n.signatures[0].verified;t=o?"verified":"failed"}else t="not_found";return o.Vu.addChat({chat:{chat:c.data,detail:{myPrivateKeyID:y,theirPublicKeyID:p,verification:t,userID:m?m.userID:"",chatUserID:m?m.userID:"",createdDate:g}}}),o.Vu.addMessage({message:{detail:{myPrivateKeyID:y},message:e}}),{chat:c.data,detail:{myPrivateKeyID:y,theirPublicKeyID:p,verification:t,userID:m?m.userID:"",chatUserID:m?m.userID:"",createdDate:g}}}))}function d(e){return(0,r.mG)(this,void 0,void 0,(function*(){const t=o.Vu.getMessages.filter((t=>t.detail.myPrivateKeyID===e)),i=n.gb.getPrivateKeys.find((t=>t.keyID===e));if(!i)throw new Error(`Could not find the private key for ${e}`);const y=yield(0,a.CS)(i.key),l=yield Promise.all(t.map((t=>(0,r.mG)(this,void 0,void 0,(function*(){let i;const r=yield(0,a.yr)({armoredMessage:t.message});if(!r)throw console.error("Not a valid pgp message",t.message),new Error("Not a valid pgp message");const o=yield(0,s.pe)({message:r,decryptionKeys:y});let l=o.data;const d=yield o.signatures[0].signature,{created:c}=d.packets[0];let u=o.signatures[0].keyID.toHex();const g=n.gb.getPublicKeys.find((e=>e.keyID===u));let p=g?g.userID:"";if(g){const e=yield(0,a.yG)({armoredKey:g.key}),r=yield(0,a.yr)({armoredMessage:t.message});if(!r)throw console.error("Not a valid pgp message",t.message),new Error("Not a valid pgp message");const n=yield(0,s.pe)({message:r,decryptionKeys:y,verificationKeys:e}),o=yield n.signatures[0].verified;i=o?"verified":"failed"}else i="not_found";if("verified"===i&&y.toPublic().getKeyID().toHex()===u){i="self";const e=JSON.parse(l);if(void 0!==e.chat&&(l=e.chat),e.theirPublicKeyID){u=e.theirPublicKeyID;const t=n.gb.getPublicKeys.find((e=>e.keyID===u));p=t?t.userID:u}}return{chat:l,detail:{myPrivateKeyID:e,theirPublicKeyID:u,verification:i,userID:p,chatUserID:g?g.userID:"",createdDate:c}}})))));o.Vu.initialiseChats(l)}))}},6598:(e,t,i)=>{i.d(t,{H:()=>a});var r=i(1914),s=i(6417);const a=({label:e,value:t})=>(0,r.Z)(t).then((()=>{s.Z.create({type:"positive",message:`Copied ${e} to clipboard`})}))},745:(e,t,i)=>{i.d(t,{HN:()=>o,Ne:()=>y,gI:()=>l,E0:()=>c,CS:()=>u,Wg:()=>g,WB:()=>p,l:()=>m,n5:()=>h,Z9:()=>v,DI:()=>f,VH:()=>K,yG:()=>D,yr:()=>I});var r=i(8430),s=i(8599),a=i(499),n=i(3673);const o=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+([a-zA-Z]{2,}|xn--[a-zA-Z\-0-9]+)))$/,y=["ecc","rsa"],l=["ed25519","curve25519","p256","p384","p521","secp256k1","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"];function d(e){return"Misformed armored text"===e?"This is not a valid PGP message or key":e}function c(e,t,i,a="ecc",n="curve25519",o=[]){return(0,r.mG)(this,void 0,void 0,(function*(){return yield(0,s.k$)({type:a,curve:n,userIDs:[...o,{name:e,email:t}],passphrase:i,format:"object"})}))}function u(e){return(0,r.mG)(this,void 0,void 0,(function*(){const t=yield new Promise((t=>a.Z.create({component:(0,n.RC)((()=>Promise.all([i.e(736),i.e(255)]).then(i.bind(i,5255)))),componentProps:{privateKeyString:e}}).onOk((e=>t(e)))));return t}))}function g(e,t,i){return(0,r.mG)(this,void 0,void 0,(function*(){const r=yield D({armoredKey:t}),a=yield(0,s.tn)({text:e}),n={message:a,encryptionKeys:r};if(i){const e=yield u(i);n.signingKeys=e}return yield(0,s.HI)(n)}))}function p(e,t,i){return(0,r.mG)(this,void 0,void 0,(function*(){const r=yield u(t),a=yield I({armoredMessage:e}),n={message:a,decryptionKeys:r};if(i){const e=yield D({armoredKey:i});n.expectSigned=!0,n.verificationKeys=e}const{data:o,signatures:y}=yield(0,s.pe)(n);let l=!1;return i&&(yield y[0].verified,l=!0),{decrypted:o,verified:l}}))}function m(e,t){return(0,r.mG)(this,void 0,void 0,(function*(){const i=yield u(t),r=yield(0,s.tn)({text:e}),a=yield(0,s.Xx)({message:r,signingKeys:i,detached:!0});return a}))}function h(e,t,i){return(0,r.mG)(this,void 0,void 0,(function*(){const r=yield D({armoredKey:t}),a=yield(0,s.tn)({text:e}),n=yield(0,s.Gi)({armoredSignature:i}),o={verificationKeys:r,message:a,signature:n},y=yield(0,s.T)(o),{verified:l}=y.signatures[0];return yield l,!0}))}function v(e){return(0,r.mG)(this,void 0,void 0,(function*(){const t=yield D({armoredKey:e}),i=yield t.getEncryptionKey();return i.getKeyID().toHex()}))}function f(e){return(0,r.mG)(this,void 0,void 0,(function*(){const t=yield D({armoredKey:e}),i=yield t.getSigningKey();return i.getKeyID().toHex()}))}function K(e){return(0,r.mG)(this,void 0,void 0,(function*(){const t=yield D({armoredKey:e});return t.users.map((e=>{var t;return null===(t=e.userID)||void 0===t?void 0:t.userID}))}))}const D=e=>(0,r.mG)(void 0,void 0,void 0,(function*(){try{return yield(0,s.xh)(e)}catch(t){const{message:e}=t;throw new Error(d(e))}})),I=({armoredMessage:e})=>(0,r.mG)(void 0,void 0,void 0,(function*(){try{return yield(0,s.Rk)({armoredMessage:e})}catch(t){const{message:e}=t;throw new Error(d(e))}}))},4435:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var r=i(3673);function s(e,t,i,s,a,n){const o=(0,r.up)("q-icon"),y=(0,r.up)("q-input"),l=(0,r.up)("show-key-details");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(y,{"model-value":e.keyValue,filled:"",readonly:"",type:"textarea",label:e.label},{append:(0,r.w5)((()=>[e.copy?((0,r.wg)(),(0,r.j4)(o,{key:0,name:"content_copy",class:"cursor-pointer",onClick:t[0]||(t[0]=t=>e.addToClipboard({label:e.label,value:e.keyValue}))})):(0,r.kq)("",!0),e.download?((0,r.wg)(),(0,r.j4)(o,{key:1,name:"download",class:"cursor-pointer",onClick:t[1]||(t[1]=t=>e.exportFile(`${e.filename}.crt`,e.keyValue))})):(0,r.kq)("",!0)])),_:1},8,["model-value","label"]),e.keyDetail?((0,r.wg)(),(0,r.j4)(l,{key:0,plainKey:e.keyValue,label:e.label},null,8,["plainKey","label"])):(0,r.kq)("",!0)])}var a=i(2841),n=i(1959),o=i(6598);const y=(0,r.aZ)({components:{ShowKeyDetails:(0,r.RC)((()=>Promise.all([i.e(736),i.e(618)]).then(i.bind(i,3618))))},name:"ShowKey",props:{keyValue:{type:String,required:!0,default:""},label:{type:String,required:!0,default:"A Key"},download:{type:Boolean,default:!1},copy:{type:Boolean,default:!1},keyDetail:{type:Boolean,default:!1}},setup(e){const t=(0,n.Fl)((()=>e.label.split(" ").join("_")));return{filename:t,exportFile:a.Z,addToClipboard:o.H}}});var l=i(4260),d=i(4842),c=i(4554),u=i(7518),g=i.n(u);const p=(0,l.Z)(y,[["render",s]]),m=p;g()(y,"components",{QInput:d.Z,QIcon:c.Z})}}]);