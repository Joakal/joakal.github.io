"use strict";(self["webpackChunksignedmail"]=self["webpackChunksignedmail"]||[]).push([[371],{1371:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});var i=a(3673),l=a(2323);const n={class:"fit row justify-between items-center"},s=(0,i.Uk)(" Write a message and it will be automatically encrypted with your private key and copied to your clipboard."),r=(0,i._)("br",null,null,-1),o=(0,i.Uk)(" Add their message and it will be automatically decrypted with your private key and available here. "),u={key:0},c={key:1},d=(0,i.Uk)(" There are messages that are currently encrypted. "),y=(0,i.Uk)("Try decrypting again"),h={key:2,style:{width:"100%"}},p={key:0};function m(e,t,a,m,v,g){const f=(0,i.up)("q-btn"),k=(0,i.up)("q-tooltip"),w=(0,i.up)("q-banner"),b=(0,i.up)("q-icon"),C=(0,i.up)("q-chat-message"),_=(0,i.up)("q-input"),D=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(D,null,{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"bg-primary text-white row full-width"},{default:(0,i.w5)((()=>{var t;return[(0,i._)("div",n,[(0,i._)("div",null,[(0,i.Wm)(f,{round:"",icon:"arrow_circle_left",onClick:e.goBack},null,8,["onClick"])]),(0,i._)("div",null,(0,l.zw)(null===(t=e.publicKey)||void 0===t?void 0:t.userID),1),(0,i._)("div",null,[(0,i.Wm)(f,{round:"",icon:"help"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{class:"text-subtitle1",style:{"max-width":"70vw"}},{default:(0,i.w5)((()=>[s,r,o])),_:1})])),_:1})])])]})),_:1}),e.publicKey?e.hasEncryptedMessages?((0,i.wg)(),(0,i.iD)("span",c,[d,(0,i.Wm)(f,{color:"primary",onClick:e.retryDecryption},{default:(0,i.w5)((()=>[y])),_:1},8,["onClick"])])):((0,i.wg)(),(0,i.iD)("div",h,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.chats,((t,a)=>((0,i.wg)(),(0,i.j4)(C,(0,i.dG)({key:a},t,{name:t.detail.chatUserID,text:[t.chat],sent:"self"===t.detail.verification,"text-color":"self"===t.detail.verification?"white":"black","bg-color":"self"===t.detail.verification?"primary":"grey-4",clickable:"",onClick:a=>"self"===t.detail.verification&&e.clickMessage(t.chat),exact:""}),{stamp:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.timestamp(t.detail.createdDate))+" ",1),"self"!==t.detail.verification?((0,i.wg)(),(0,i.iD)("span",p,["verified"===t.detail.verification?((0,i.wg)(),(0,i.j4)(b,{key:0,name:"check_circle_outline",color:"positive"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" The signature verification succeeded for their public key ("+(0,l.zw)(e.theirPublicKeyID)+") ",1)])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(b,{key:1,name:"error_outline",color:"negative"},{default:(0,i.w5)((()=>["not_found"===t.detail.verification?((0,i.wg)(),(0,i.j4)(k,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)(" There was no matching public key found for their public key ("+(0,l.zw)(e.theirPublicKeyID)+") ",1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" The signature verification failed for their public key ("+(0,l.zw)(e.theirPublicKeyID)+") ",1)])),_:1})])),_:2},1024))])):(0,i.kq)("",!0)])),_:2},1040,["name","text","sent","text-color","bg-color","onClick"])))),128)),(0,i.Wm)(_,{"bottom-slots":"",modelValue:e.inputChat,"onUpdate:modelValue":t[1]||(t[1]=t=>e.inputChat=t),outlined:"",type:"textarea",hint:"Write your message",error:!!e.inputChatError.length,"error-message":e.inputChatError},{append:(0,i.w5)((()=>[""!==e.inputChat?((0,i.wg)(),(0,i.j4)(b,{key:0,name:"close",onClick:t[0]||(t[0]=t=>e.inputChat=""),class:"cursor-pointer"})):(0,i.kq)("",!0)])),before:(0,i.w5)((()=>[(0,i.Wm)(f,{round:"",dense:"",flat:"",icon:"mail",onClick:e.handleTheirMessage},null,8,["onClick"])])),after:(0,i.w5)((()=>[(0,i.Wm)(f,{round:"",dense:"",flat:"",icon:"send",onClick:e.submitMessage},null,8,["onClick"])])),_:1},8,["modelValue","error","error-message"])])):((0,i.wg)(),(0,i.iD)("span",u," No public key could be found. Have you added their public key? "))])),_:1})}var v=a(8430),g=a(8825),f=a(1959),k=a(9582),w=a(912),b=a(6598),C=a(27),_=a(2079),D=a(120),K=a.n(D),I=a(6002),M=a.n(I);K().extend(M());const P=e=>e?K()().to(K()(e)):void 0,W=(0,i.aZ)({name:"Chats",setup(){const e=(0,g.Z)(),t=(0,k.tv)(),a=(0,k.yj)(),l=(0,f.iH)(""),n=(0,f.iH)(""),s=(0,f.iH)(""),r=(0,f.iH)(""),o=(0,f.Fl)((()=>C.Vu.getChatsByPrivateKeyIDAndPublicKeyID(l.value,n.value))),u=(0,f.Fl)((()=>C.Vu.getMessagesByPrivateKeyID(l.value))),c=(0,f.Fl)((()=>_.gb.getPublicKeyByKeyID(n.value))),d=()=>(0,v.mG)(this,void 0,void 0,(function*(){if(u.value.length>o.value.length)try{yield(0,w.Z0)(l.value)}catch(t){const a=t;e.notify({type:"negative",message:`Could not convert messages into chats. Reason: ${a.message}`})}}));(0,i.bv)((()=>(0,v.mG)(this,void 0,void 0,(function*(){a.params.myPrivateKeyID&&(l.value=a.params.myPrivateKeyID,n.value=a.params.theirPublicKeyID,c.value&&(yield d()))}))));const y=()=>(0,v.mG)(this,void 0,void 0,(function*(){r.value="";try{yield(0,w.yv)(s.value),s.value=""}catch(e){const t=e;r.value=`Could not process message. Reason: ${t.message}`}})),h=()=>(0,v.mG)(this,void 0,void 0,(function*(){r.value="";try{const{chat:e,message:t}=yield p();C.Vu.addChat({chat:e}),C.Vu.addMessage({message:t}),s.value=""}catch(e){const t=e;r.value=`Could not process message. Reason: ${t.message}`}})),p=e=>(0,v.mG)(this,void 0,void 0,(function*(){const{theirEncryptedMessage:t,chat:a,message:i}=yield(0,w.Ji)(e||s.value,n.value,l.value);return yield(0,b.H)({label:"Encrypted message",value:t}),{chat:a,message:i}}));return{hasEncryptedMessages:(0,f.Fl)((()=>C.Vu.hasEncryptedMessages(l.value))),inputChat:s,inputChatError:r,chats:o,theirPublicKeyID:n,publicKey:c,timestamp:P,rowClick:e=>t.push({name:"history",params:{id:e}}),clickMessage:p,handleTheirMessage:y,submitMessage:h,retryDecryption:()=>(0,v.mG)(this,void 0,void 0,(function*(){return yield d()})),goBack:()=>t.push({name:"chats",params:{myPrivateKeyID:l.value}})}}});var Z=a(4260),q=a(4379),x=a(5607),U=a(8240),j=a(8870),E=a(629),T=a(4554),V=a(4842),B=a(7518),G=a.n(B);const H=(0,Z.Z)(W,[["render",m]]),Q=H;G()(W,"components",{QPage:q.Z,QBanner:x.Z,QBtn:U.Z,QTooltip:j.Z,QChatMessage:E.Z,QIcon:T.Z,QInput:V.Z})}}]);